#!/usr/bin/env node

'use strict';

require('v8-compile-cache');

const importLocal = require('import-local');
const runCLI = require('../lib/bootstrap');
const { yellow } = require('colorette');
const { error, success } = require('../lib/utils/logger');
const { packageExists } = require('../lib/utils/package-exists');
const { promptInstallation } = require('../lib/utils/prompt-installation');
const console = require('customLog');

// Prefer the local installation of `webpack-cli`
if (importLocal(__filename)) {
    return;
}

process.title = 'webpack';

const [, , ...rawArgs] = process.argv;
if (packageExists('webpack')) {
    console.log("ðŸŒº è¿›å…¥cliæ–‡ä»¶ï¼Œåˆ¤æ–­å­˜åœ¨ webpack åŒ…ï¼Œå‡†å¤‡æ‰§è¡Œ CLIï¼Œå‚æ•°: ", rawArgs);
    runCLI(rawArgs);
} else {
    console.log("ðŸŒº è¿›å…¥cliæ–‡ä»¶ï¼Œåˆ¤æ–­ä¸å­˜åœ¨ webpack åŒ…ï¼Œå°è¯•å®‰è£…");
    promptInstallation('webpack -W', () => {
        error(`It looks like ${yellow('webpack')} is not installed.`);
    })
        .then(() => {
            success(`${yellow('webpack')} was installed sucessfully.`);

            runCLI(rawArgs);
        })
        .catch(() => {
            error(`Action Interrupted, Please try once again or install ${yellow('webpack')} manually.`);

            process.exit(2);
        });
}
